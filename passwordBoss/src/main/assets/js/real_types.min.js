var TypeDefinitions=function(){var a={FieldTypes:{unknown:"unknown",email:"email",username:"username",accountNumber:"accountNumber",address1:"address1",address2:"address2",addressRef:"addressRef",apt:"apt",autologin:"autologin",bank:"bank",cardNumber:"cardNumber",cardType:"cardType",city:"city",color:"color",company:"company",country:"country",cvv:"cvv",dateOfBirth:"dateOfBirth",domain:"domain",driverLicenceNumber:"driverLicenceNumber",expiresDay:"expiresDay",expiresMonth:"expiresMonth",expiresYear:"expiresYear",
firstName:"firstName",gender:"gender",iban:"iban",issueDate:"issueDate",issuingBank:"issuingBank",lastName:"lastName",memberID:"memberID",middleName:"middleName",nameOnAccount:"nameOnAccount",nameOnCard:"nameOnCard",nationality:"nationality",notes:"notes",passportNumber:"passportNumber",password:"password",phoneNumber:"phoneNumber",pin:"pin",placeOfIssue:"placeOfIssue",reEnterPassword:"reEnterPassword",routingNumber:"routingNumber",ssn:"ssn",state:"state",subDomain:"subDomain",swift:"swift",title:"title",
useSecureBrowser:"useSecureBrowser",zipCode:"zipCode",fullName:"fullName"},ButtonTypes:{signupButton:"signupButton",loginButton:"loginButton",unknownButton:"unknownButton"},FormTypes:{unknownForm:"unknownForm",signupForm:"signupForm",loginForm:"loginForm"},RealTypeUsage:{capture:"capture",fill:"fill"}};a.FieldTypes.expires=[a.FieldTypes.expiresDay,a.FieldTypes.expiresMonth,a.FieldTypes.expiresYear];return a}();"undefined"!==typeof module&&(module.exports=TypeDefinitions);
var Utils=function(){return{normalizeSubmitData:function(a){if("string"===typeof a){var b={};a.split("&").forEach(function(a){a=a.split("=");void 0===b[a[0]]&&(b[a[0]]=[]);b[decodeURIComponent(a[0])].push(decodeURIComponent(a[1]))});return b}return a},getCreditCardType:function(a){var b="Other";/^5[1-5]/.test(a)?b="MasterCard":/^4/.test(a)?b="Visa":/^3[47]/.test(a)&&(b="American Express");return b},deriveDate:function(a){return{day:a.getUTCDate(),month:a.getUTCMonth()+1,year:a.getUTCFullYear()}},
composeDate:function(a,b,d){return a?(new Date(Date.UTC(d,b-1,a,23,59,59,999))).toISOString():(new Date(Date.UTC(d,b,1)-1)).toISOString()},isEmailValid:function(a){return/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(a)}}}();"undefined"!==typeof module&&(module.exports=Utils);"undefined"!==typeof require&&(TypeDefinitions=require("./type-definitions"));
var FormTypeDetector=function(a){function b(b){return b.buttonRecords.some(function(b){return b.buttonType===a.ButtonTypes.signupButton})}function d(b){return b.buttonRecords.some(function(b){return b.buttonType===a.ButtonTypes.loginButton})}function g(b,d){function n(){var d=b.inputRecords.some(function(e){return e.fieldType===a.FieldTypes.password}),h=b.inputRecords.some(function(e){return e.fieldType===a.FieldTypes.email}),v=b.inputRecords.some(function(e){return e.fieldType===a.FieldTypes.username});
return d&&h!==v}function g(){var d=[a.FieldTypes.username,a.FieldTypes.email,a.FieldTypes.password];return b.inputRecords.some(function(a){return-1!==d.indexOf(a.fieldType)})}return function(b){var d=[a.FieldTypes.firstName,a.FieldTypes.lastName,a.FieldTypes.reEnterPassword,a.FieldTypes.fullName];return b.inputRecords.every(function(a){return-1===d.indexOf(a.fieldType)})}(b)&&(n()||d&&g()||m(b))}function m(b){var d=b.inputRecords.filter(function(b){return b.fieldType!==a.FieldTypes.unknown}).map(function(a){return a.fieldType});
if(0===d.length)return!1;b=d.every(function(b){return b===a.FieldTypes.username});d=d.every(function(b){return b===a.FieldTypes.password});return b||d}function p(k,h){return b(k)&&!d(k)?a.FormTypes.signupForm:g(k,h)?a.FormTypes.loginForm:a.FormTypes.unknownForm}function l(b,d){return b.formRecords.filter(function(b){return FormTypeDetector.detectFormType(b,d)===a.FormTypes.loginForm})[0]||null}function r(a,b){return a.formRecords.filter(function(a){return a.inputRecords.some(function(a){return a.path===
b})})[0]}return{detectFormType:p,detectFormTypeJson:function(a,b){return p(JSON.parse(a),b)},findFormRecordFromSubmitData:function(a,b){var d=a.formRecords.map(function(a){return{formRecord:a,rank:a.inputRecords.filter(function(a){return void 0!==b[a.name]}).length}}).sort(function(a,b){return b.rank-a.rank});return 0<d.length?d[0].formRecord:void 0},findLoginFormRecord:function(a,b){return JSON.stringify(l(JSON.parse(a),b))},isProbablyMultiStep:function(a){return m(JSON.parse(a))},detectFormTypeForInputPath:function(a,
b,d){a=r(JSON.parse(a),d);return p(a,b)}}}(TypeDefinitions);"undefined"!==typeof module&&(module.exports=FormTypeDetector);if("undefined"!==typeof require)var TypeDefinitions=require("./type-definitions"),PhoneUtils=require("./phone-utils");
var RealTypeFactory=function(a){var b={discriminatorFieldTypes:[],isValueSame:function(a,e,b){return void 0!==a[b]&&void 0!==e[b]&&a[b]===e[b]},isComposedOf:function(a){return 0===this.discriminatorFieldTypes.length?this.fieldTypes.every(function(e){return 0<=a.indexOf(e)}):this.discriminatorFieldTypes.some(function(e){return 0<=a.indexOf(e)},this)},isDomainSpecific:!1,captureFormTypes:[a.FormTypes.loginForm,a.FormTypes.signupForm,a.FormTypes.unknownForm],fillFormTypes:[a.FormTypes.loginForm,a.FormTypes.signupForm,
a.FormTypes.unknownForm]},d=Object.create(b);d.type="PI";d.captureFormTypes=[a.FormTypes.signupForm,a.FormTypes.unknownForm];d.fillFormTypes=[a.FormTypes.signupForm,a.FormTypes.unknownForm];var g=Object.create(b);g.type="DW";g.captureFormTypes=[a.FormTypes.signupForm,a.FormTypes.unknownForm];g.fillFormTypes=[a.FormTypes.signupForm,a.FormTypes.unknownForm];var m=Object.create(d);m.subType="Names";m.fieldTypes=[a.FieldTypes.firstName,a.FieldTypes.middleName,a.FieldTypes.lastName,a.FieldTypes.fullName];
m.discriminatorFieldTypes=[a.FieldTypes.firstName,a.FieldTypes.middleName,a.FieldTypes.lastName,a.FieldTypes.fullName];m.getCaption=function(a){a=JSON.parse(a);return a.firstName+" "+a.lastName};m.compare=function(b,e){var f=JSON.parse(b),c=JSON.parse(e);return this.isValueSame(f,c,a.FieldTypes.firstName)&&this.isValueSame(f,c,a.FieldTypes.lastName)||this.isValueSame(f,c,a.FieldTypes.fullName)};m.isComposedOf=function(b){return 0<=b.indexOf(a.FieldTypes.firstName)&&0<=b.indexOf(a.FieldTypes.lastName)||
0<=b.indexOf(a.FieldTypes.fullName)};var p=Object.create(d);p.subType="Address";p.fieldTypes=[a.FieldTypes.address1,a.FieldTypes.address2,a.FieldTypes.city,a.FieldTypes.country,a.FieldTypes.state,a.FieldTypes.zipCode];p.discriminatorFieldTypes=[a.FieldTypes.address1,a.FieldTypes.address2,a.FieldTypes.zipCode];p.getCaption=function(a){return JSON.parse(a).address1};p.compare=function(b,e){var f=JSON.parse(b),c=JSON.parse(e);return this.isValueSame(f,c,a.FieldTypes.address1)};var l=Object.create(d);
l.subType="Company";l.fieldTypes=[a.FieldTypes.company];l.discriminatorFieldTypes=[a.FieldTypes.company];l.getCaption=function(a){return JSON.parse(a).company};l.compare=function(b,e){var f=JSON.parse(b),c=JSON.parse(e);return this.isValueSame(f,c,a.FieldTypes.company)};var r=Object.create(d);r.subType="DriverLicense";r.fieldTypes=[a.FieldTypes.firstName,a.FieldTypes.lastName,a.FieldTypes.country,a.FieldTypes.state,a.FieldTypes.driverLicenceNumber,a.FieldTypes.expires,a.FieldTypes.placeOfIssue];r.discriminatorFieldTypes=
[a.FieldTypes.driverLicenceNumber];r.getCaption=function(a){return JSON.parse(a).driverLicenceNumber};r.compare=function(b,e){var f=JSON.parse(b),c=JSON.parse(e);return this.isValueSame(f,c,a.FieldTypes.driverLicenceNumber)};var k=Object.create(d);k.subType="Email";k.fieldTypes=[a.FieldTypes.email];k.discriminatorFieldTypes=[a.FieldTypes.email];k.getCaption=function(a){return JSON.parse(a).email};k.compare=function(b,e){var f=JSON.parse(b),c=JSON.parse(e);return this.isValueSame(f,c,a.FieldTypes.email)};
k.captureFormTypes=[a.FormTypes.signupForm,a.FormTypes.unknownForm,a.FormTypes.loginForm];k.fillFormTypes=[a.FormTypes.signupForm,a.FormTypes.unknownForm,a.FormTypes.loginForm];var h=Object.create(d);h.subType="MemberIDs";h.fieldTypes=[a.FieldTypes.firstName,a.FieldTypes.lastName,a.FieldTypes.memberID];h.discriminatorFieldTypes=[a.FieldTypes.memberID];h.getCaption=function(a){return JSON.parse(a).memberID};h.compare=function(b,e){var f=JSON.parse(b),c=JSON.parse(e);return this.isValueSame(f,c,a.FieldTypes.memberID)};
var n=Object.create(d);n.subType="Passport";n.fieldTypes=[a.FieldTypes.firstName,a.FieldTypes.lastName,a.FieldTypes.nationality,a.FieldTypes.dateOfBirth,a.FieldTypes.passportNumber,a.FieldTypes.issueDate,a.FieldTypes.expires,a.FieldTypes.placeOfIssue];n.discriminatorFieldTypes=[a.FieldTypes.passportNumber];n.getCaption=function(a){return JSON.parse(a).passportNumber};n.compare=function(b,e){var f=JSON.parse(b),c=JSON.parse(e);return this.isValueSame(f,c,a.FieldTypes.passportNumber)};var u=Object.create(d);
u.subType="PhoneNumber";u.fieldTypes=[a.FieldTypes.phoneNumber];u.discriminatorFieldTypes=[a.FieldTypes.phoneNumber];u.getCaption=function(a){return JSON.parse(a).phoneNumber};u.compare=function(b,e){var f=JSON.parse(b),c=JSON.parse(e);return this.isValueSame(f,c,a.FieldTypes.phoneNumber)};d=Object.create(d);d.subType="SocialSecurity";d.fieldTypes=[a.FieldTypes.firstName,a.FieldTypes.lastName,a.FieldTypes.dateOfBirth,a.FieldTypes.ssn];d.discriminatorFieldTypes=[a.FieldTypes.ssn];d.getCaption=function(a){return JSON.parse(a).ssn};
d.compare=function(b,e){var f=JSON.parse(b),c=JSON.parse(e);return this.isValueSame(f,c,a.FieldTypes.ssn)};var t=Object.create(g);t.subType="Bank";t.fieldTypes=[a.FieldTypes.country,a.FieldTypes.bank,a.FieldTypes.nameOnAccount,a.FieldTypes.swift,a.FieldTypes.iban,a.FieldTypes.routingNumber,a.FieldTypes.accountNumber];t.discriminatorFieldTypes=[a.FieldTypes.bank];t.getCaption=function(a){return JSON.parse(a).bank};g=Object.create(g);g.subType="CreditCard";g.fieldTypes=[a.FieldTypes.cardNumber,a.FieldTypes.cardType,
a.FieldTypes.nameOnCard,a.FieldTypes.placeOfIssue,a.FieldTypes.cvv,a.FieldTypes.pin,a.FieldTypes.expires];g.discriminatorFieldTypes=[a.FieldTypes.cardNumber];g.getCaption=function(a){a=JSON.parse(a);return(a.cardType||"Other")+" *"+a.cardNumber.slice(-4)};g.compare=function(b,e){var f=JSON.parse(b),c=JSON.parse(e);return this.isValueSame(f,c,a.FieldTypes.cardNumber)};b=Object.create(b);b.type="PV";b.subType="PV";b.fieldTypes=[a.FieldTypes.username,a.FieldTypes.email,a.FieldTypes.password,a.FieldTypes.domain];
b.discriminatorFieldTypes=[a.FieldTypes.password,a.FieldTypes.email,a.FieldTypes.username];b.getCaption=function(a){return JSON.parse(a).username||""};b.compare=function(b,e){var f=JSON.parse(b),c=JSON.parse(e);return this.isValueSame(f,c,a.FieldTypes.username)||this.isValueSame(f,c,a.FieldTypes.email)};b.isDomainSpecific=!0;b.fillFormTypes=[a.FormTypes.loginForm];b.isComposedOf=function(b,e){var f=0<=b.indexOf(a.FieldTypes.password),c=0<=b.indexOf(a.FieldTypes.username),d=0<=b.indexOf(a.FieldTypes.email);
return e?c||d||f:f&&(c||d)};var w=[b,m,p,l,r,k,h,n,u,d,t,g];return{createRealType:function(a){return w.filter(function(b){return a===b.subType})[0]},getAllRealTypes:function(){return w}}}(TypeDefinitions,PhoneUtils);"undefined"!==typeof module&&(module.exports=RealTypeFactory);"undefined"!==typeof require&&(TypeDefinitions=require("./type-definitions"));function Node(a,b){this.path=a;this.inputRecords=b.filter(function(a){return 0===a.path.indexOf(this.path)},this);this.allInputRecords=b}
Node.prototype.parent=function(){return""===this.path?null:new Node(this.path.split(">").slice(0,-1).join(">"),this.allInputRecords)};Node.prototype.findConflicts=function(a){var b={},d=[];this.inputRecords.forEach(function(g){0<=a.indexOf(g.fieldType)&&Object.prototype.hasOwnProperty.call(b,g.fieldType)&&d.push(g);g.fieldType!==TypeDefinitions.FieldTypes.unknown&&(b[g.fieldType]=!0)});return d};Node.prototype.hasConflicts=function(a){return 0<this.findConflicts(a).length};
"undefined"!==typeof module&&(module.exports=Node);"undefined"!==typeof require&&(Utils=require("./utils"),TypeDefinitions=require("./type-definitions"),RealTypeFactory=require("./real-type-factory"),FormTypeDetector=require("./form-type-detector"),Node=require("./node"));
var RealTypeDetector=function(a,b,d,g,m){function p(e,f,c,d,q){var g=e.filter(function(a){return a.fieldType!==b.FieldTypes.unknown}).map(function(a){return a.fieldType});if(0===g.length)return[];var k=g.some(function(a){return a===b.FieldTypes.username}),y=g.every(function(a){return a===b.FieldTypes.username}),h=g.every(function(a){return a===b.FieldTypes.password}),m=y||h;return a.filter(function(a){return c!==b.RealTypeUsage.fill||0<=a.fillFormTypes.indexOf(d)}).filter(function(a){return c!==b.RealTypeUsage.capture||
0<=a.captureFormTypes.indexOf(d)}).filter(function(a){return a.isComposedOf(g,c!==b.RealTypeUsage.capture&&(q||m))}).map(function(a){return{name:a.subType,isDomainSpecific:!!a.isDomainSpecific,inputRecords:e.filter(function(e){return a.fieldTypes.some(function(f){return"PV"===a.type&&f===b.FieldTypes.email&&k?!1:"object"===typeof f?0<=f.indexOf(e.fieldType):f===e.fieldType})}).map(function(e){e=JSON.parse(JSON.stringify(e));"PV"===a.type&&e.fieldType===b.FieldTypes.email&&(e.fieldType=b.FieldTypes.username);
return e}),path:f}})}function l(e,f,c){for(var x=[],q,g,k,h=e.inputRecords,l=(new m(e.path,h)).findConflicts(Object.keys(b.FieldTypes)),n=d.detectFormType(e,c);0<l.length;){for(q=new m(l[0].path,h);null!==q.parent()&&!1===q.parent().hasConflicts([l[0].fieldType]);)q=q.parent();k=a.filter(function(a){return 0<=a.discriminatorFieldTypes.indexOf(l[0].fieldType)});0===k.length?(h=h.filter(function(a){return l[0]!==a}),l.splice(0,1)):(g=q.inputRecords.filter(function(a){return k.some(function(b){return 0<=
b.fieldTypes.indexOf(a.fieldType)})}),p(g,q.path,f,n,c).forEach(function(a){x.push(a)}),l=l.filter(function(a){return 0>g.indexOf(a)}),h=h.filter(function(a){return 0>g.indexOf(a)}))}p(h,e.path,f,n,c).forEach(function(a){x.push(a)});return x}function r(a,f){var c=[];a.inputRecords=a.inputRecords.filter(function(a){return 0<a.value.trim().length});l(a,b.RealTypeUsage.capture,f).forEach(function(a){var e={};a.inputRecords.forEach(function(a){e[a.fieldType]=a.value});"CreditCard"===a.name&&(e[b.FieldTypes.cardType]=
g.getCreditCardType(e[b.FieldTypes.cardNumber]));if("Email"!==a.name||g.isEmailValid(e[b.FieldTypes.email]))n(e),h("expires",e),h("dateOfBirth",e),h("issueDate",e),c.push({realType:a.name,data:e})});return c}function k(a,b){if(b[a]){var c=g.deriveDate(new Date(b[a]));b[a+"Day"]=c.day;b[a+"Month"]=c.month;b[a+"Year"]=c.year;delete b[a]}}function h(a,b){var c=b[a+"Year"],d=b[a+"Month"],q=b[a+"Day"];d&&c&&(b[a]=g.composeDate(q?q:void 0,d,c))}function n(a){var f=a[b.FieldTypes.fullName];f&&(f=f.split(" "),
a[b.FieldTypes.firstName]=f[0],a[b.FieldTypes.lastName]=f[1],delete a[b.FieldTypes.fullName])}function u(a,b,c,d){return l(a,b,c).filter(function(a){return a.inputRecords.some(function(a){return a.path===d})})}function t(a,f,c,d,g){a=l(a,b.RealTypeUsage.fill,f);var h=[];c[b.FieldTypes.fullName]=c.firstName+" "+c.lastName;k("expires",c);k("dateOfBirth",c);k("issueDate",c);a.filter(function(a){return a.name===d}).forEach(function(a){a.inputRecords.forEach(function(b){h.push({fieldPath:b.path,fieldValue:c[b.fieldType]?
c[b.fieldType]:"",alternativeValues:[],overwriteExistingValue:"*"===g||0===g.indexOf(a.path)})})});return h}function w(a,f){var c=[];a.inputRecords.filter(function(a){return a.fieldType===b.FieldTypes.password||a.fieldType===b.FieldTypes.reEnterPassword}).forEach(function(a){c.push({fieldPath:a.path,fieldValue:f,alternativeValues:[],overwriteExistingValue:!0})});return c}function v(a,b){return a.formRecords.filter(function(a){return a.inputRecords.some(function(a){return a.path===b})})[0]}return{extractFromPageRecord:function(a,
f,c){a=v(JSON.parse(a),c);a=l(a,"fill",f);a=a.filter(function(a){var e=a.inputRecords.some(function(a){return a.fieldType===b.FieldTypes.username||a.fieldType===b.FieldTypes.email});return!f||"PV"!==a.name||e});a=a.map(function(a){a.selected=a.inputRecords.some(function(a){return a.path===c});return a});return JSON.stringify(a)},getRealTypeDataForSubmit:function(a,b){var c=JSON.parse(a);return JSON.stringify(r(c,b))},generateFillDataMessage:function(a,b,c,d,g){return JSON.stringify(t(JSON.parse(a),
b,JSON.parse(c),d,g))},generateFillDataMessageForPageRecord:function(a,b,c,d,g,h,k,l){a=v(JSON.parse(a),g);return JSON.stringify({formPath:a.path,data:t(a,b,JSON.parse(c),d,g),executeLogin:"true"===h,message:"fillDataBegin",contentId:k,tabId:l})},generateFillDataMessageForOneClickLogin:function(a,b,c,g,h){a=JSON.parse(d.findLoginFormRecord(a,b));return JSON.stringify({formPath:a.path,data:t(a,b,JSON.parse(c),"PV","*"),executeLogin:!0,message:"fillDataBegin",contentId:g,tabId:h})},getFormRecordForInputPath:function(a,
b){return JSON.stringify(v(JSON.parse(a),b))},getRealTypeForInputPath:function(a,b,c){a=v(JSON.parse(a),b);return JSON.stringify(u(a,"fill",c,b))},generatePasswordGeneratorMessage:function(a,b,c,d,g){a=v(JSON.parse(a),c);return JSON.stringify({formPath:a.path,data:w(a,b),executeLogin:!1,message:"fillDataBegin",contentId:d,tabId:g})}}}(RealTypeFactory.getAllRealTypes(),TypeDefinitions,FormTypeDetector,Utils,Node);"undefined"!==typeof module&&(module.exports=RealTypeDetector);

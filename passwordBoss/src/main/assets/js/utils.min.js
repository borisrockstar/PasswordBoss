var TypeDefinitions=function(){var a={FieldTypes:{unknown:"unknown",email:"email",username:"username",accountNumber:"accountNumber",address1:"address1",address2:"address2",addressRef:"addressRef",apt:"apt",autologin:"autologin",bank:"bank",cardNumber:"cardNumber",cardType:"cardType",city:"city",color:"color",company:"company",country:"country",cvv:"cvv",dateOfBirth:"dateOfBirth",domain:"domain",driverLicenceNumber:"driverLicenceNumber",expiresDay:"expiresDay",expiresMonth:"expiresMonth",expiresYear:"expiresYear",
firstName:"firstName",gender:"gender",iban:"iban",issueDate:"issueDate",issuingBank:"issuingBank",lastName:"lastName",memberID:"memberID",middleName:"middleName",nameOnAccount:"nameOnAccount",nameOnCard:"nameOnCard",nationality:"nationality",notes:"notes",passportNumber:"passportNumber",password:"password",phoneNumber:"phoneNumber",pin:"pin",placeOfIssue:"placeOfIssue",reEnterPassword:"reEnterPassword",routingNumber:"routingNumber",ssn:"ssn",state:"state",subDomain:"subDomain",swift:"swift",title:"title",
useSecureBrowser:"useSecureBrowser",zipCode:"zipCode",fullName:"fullName"},ButtonTypes:{signupButton:"signupButton",loginButton:"loginButton",unknownButton:"unknownButton"},FormTypes:{unknownForm:"unknownForm",signupForm:"signupForm",loginForm:"loginForm"},RealTypeUsage:{capture:"capture",fill:"fill"}};a.FieldTypes.expires=[a.FieldTypes.expiresDay,a.FieldTypes.expiresMonth,a.FieldTypes.expiresYear];return a}();"undefined"!==typeof module&&(module.exports=TypeDefinitions);
"undefined"!==typeof require&&(TypeDefinitions=require("./type-definitions"));
var RealTypeFactory=function(a){var b={discriminatorFieldTypes:[],isValueSame:function(a,g,c){return void 0!==a[c]&&void 0!==g[c]&&a[c]===g[c]},isComposedOf:function(a){return 0===this.discriminatorFieldTypes.length?this.fieldTypes.every(function(g){return 0<=a.indexOf(g)}):this.discriminatorFieldTypes.some(function(g){return 0<=a.indexOf(g)},this)},isDomainSpecific:!1,captureFormTypes:[a.FormTypes.loginForm,a.FormTypes.signupForm,a.FormTypes.unknownForm],fillFormTypes:[a.FormTypes.loginForm,a.FormTypes.signupForm,
a.FormTypes.unknownForm]},d=Object.create(b);d.type="PI";d.captureFormTypes=[a.FormTypes.signupForm,a.FormTypes.unknownForm];d.fillFormTypes=[a.FormTypes.signupForm,a.FormTypes.unknownForm];var f=Object.create(b);f.type="DW";f.captureFormTypes=[a.FormTypes.signupForm,a.FormTypes.unknownForm];f.fillFormTypes=[a.FormTypes.signupForm,a.FormTypes.unknownForm];var l=Object.create(d);l.subType="Names";l.fieldTypes=[a.FieldTypes.firstName,a.FieldTypes.middleName,a.FieldTypes.lastName,a.FieldTypes.fullName];
l.discriminatorFieldTypes=[a.FieldTypes.firstName,a.FieldTypes.middleName,a.FieldTypes.lastName,a.FieldTypes.fullName];l.getCaption=function(a){a=JSON.parse(a);return a.firstName+" "+a.lastName};l.compare=function(e,g){var c=JSON.parse(e),h=JSON.parse(g);return this.isValueSame(c,h,a.FieldTypes.firstName)&&this.isValueSame(c,h,a.FieldTypes.lastName)||this.isValueSame(c,h,a.FieldTypes.fullName)};l.isComposedOf=function(e){return 0<=e.indexOf(a.FieldTypes.firstName)&&0<=e.indexOf(a.FieldTypes.lastName)||
0<=e.indexOf(a.FieldTypes.fullName)};var q=Object.create(d);q.subType="Address";q.fieldTypes=[a.FieldTypes.address1,a.FieldTypes.address2,a.FieldTypes.city,a.FieldTypes.country,a.FieldTypes.state,a.FieldTypes.zipCode];q.discriminatorFieldTypes=[a.FieldTypes.address1,a.FieldTypes.address2,a.FieldTypes.zipCode];q.getCaption=function(a){return JSON.parse(a).address1};q.compare=function(e,g){var c=JSON.parse(e),h=JSON.parse(g);return this.isValueSame(c,h,a.FieldTypes.address1)};var m=Object.create(d);
m.subType="Company";m.fieldTypes=[a.FieldTypes.company];m.discriminatorFieldTypes=[a.FieldTypes.company];m.getCaption=function(a){return JSON.parse(a).company};m.compare=function(e,g){var c=JSON.parse(e),h=JSON.parse(g);return this.isValueSame(c,h,a.FieldTypes.company)};var r=Object.create(d);r.subType="DriverLicense";r.fieldTypes=[a.FieldTypes.firstName,a.FieldTypes.lastName,a.FieldTypes.country,a.FieldTypes.state,a.FieldTypes.driverLicenceNumber,a.FieldTypes.expires,a.FieldTypes.placeOfIssue];r.discriminatorFieldTypes=
[a.FieldTypes.driverLicenceNumber];r.getCaption=function(a){return JSON.parse(a).driverLicenceNumber};r.compare=function(e,g){var c=JSON.parse(e),h=JSON.parse(g);return this.isValueSame(c,h,a.FieldTypes.driverLicenceNumber)};var k=Object.create(d);k.subType="Email";k.fieldTypes=[a.FieldTypes.email];k.discriminatorFieldTypes=[a.FieldTypes.email];k.getCaption=function(a){return JSON.parse(a).email};k.compare=function(e,g){var c=JSON.parse(e),h=JSON.parse(g);return this.isValueSame(c,h,a.FieldTypes.email)};
k.captureFormTypes=[a.FormTypes.signupForm,a.FormTypes.unknownForm,a.FormTypes.loginForm];k.fillFormTypes=[a.FormTypes.signupForm,a.FormTypes.unknownForm,a.FormTypes.loginForm];var p=Object.create(d);p.subType="MemberIDs";p.fieldTypes=[a.FieldTypes.firstName,a.FieldTypes.lastName,a.FieldTypes.memberID];p.discriminatorFieldTypes=[a.FieldTypes.memberID];p.getCaption=function(a){return JSON.parse(a).memberID};p.compare=function(e,g){var c=JSON.parse(e),h=JSON.parse(g);return this.isValueSame(c,h,a.FieldTypes.memberID)};
var n=Object.create(d);n.subType="Passport";n.fieldTypes=[a.FieldTypes.firstName,a.FieldTypes.lastName,a.FieldTypes.nationality,a.FieldTypes.dateOfBirth,a.FieldTypes.passportNumber,a.FieldTypes.issueDate,a.FieldTypes.expires,a.FieldTypes.placeOfIssue];n.discriminatorFieldTypes=[a.FieldTypes.passportNumber];n.getCaption=function(a){return JSON.parse(a).passportNumber};n.compare=function(e,g){var c=JSON.parse(e),h=JSON.parse(g);return this.isValueSame(c,h,a.FieldTypes.passportNumber)};var t=Object.create(d);
t.subType="PhoneNumber";t.fieldTypes=[a.FieldTypes.phoneNumber];t.discriminatorFieldTypes=[a.FieldTypes.phoneNumber];t.getCaption=function(a){return JSON.parse(a).phoneNumber};t.compare=function(e,g){var c=JSON.parse(e),h=JSON.parse(g);return this.isValueSame(c,h,a.FieldTypes.phoneNumber)};var u=Object.create(d);u.subType="SocialSecurity";u.fieldTypes=[a.FieldTypes.firstName,a.FieldTypes.lastName,a.FieldTypes.dateOfBirth,a.FieldTypes.ssn];u.discriminatorFieldTypes=[a.FieldTypes.ssn];u.getCaption=
function(a){return JSON.parse(a).ssn};u.compare=function(e,g){var c=JSON.parse(e),h=JSON.parse(g);return this.isValueSame(c,h,a.FieldTypes.ssn)};d=Object.create(d);d.subType="SecureNotes";d.isComposedOf=function(){return!1};d.getCaption=function(){return""};d.compare=function(){return!1};var w=Object.create(f);w.subType="Bank";w.fieldTypes=[a.FieldTypes.country,a.FieldTypes.bank,a.FieldTypes.nameOnAccount,a.FieldTypes.swift,a.FieldTypes.iban,a.FieldTypes.routingNumber,a.FieldTypes.accountNumber];
w.discriminatorFieldTypes=[a.FieldTypes.bank];w.getCaption=function(a){return JSON.parse(a).bank};f=Object.create(f);f.subType="CreditCard";f.fieldTypes=[a.FieldTypes.cardNumber,a.FieldTypes.cardType,a.FieldTypes.nameOnCard,a.FieldTypes.placeOfIssue,a.FieldTypes.cvv,a.FieldTypes.pin,a.FieldTypes.expires];f.discriminatorFieldTypes=[a.FieldTypes.cardNumber];f.getCaption=function(a){a=JSON.parse(a);return(a.cardType||"Other")+" *"+a.cardNumber.slice(-4)};f.compare=function(e,g){var c=JSON.parse(e),h=
JSON.parse(g);return this.isValueSame(c,h,a.FieldTypes.cardNumber)};b=Object.create(b);b.type="PV";b.subType="PV";b.fieldTypes=[a.FieldTypes.username,a.FieldTypes.email,a.FieldTypes.password,a.FieldTypes.domain];b.discriminatorFieldTypes=[a.FieldTypes.password,a.FieldTypes.email,a.FieldTypes.username];b.getCaption=function(a){return JSON.parse(a).username||""};b.compare=function(e,g){var c=JSON.parse(e),h=JSON.parse(g);return this.isValueSame(c,h,a.FieldTypes.username)||this.isValueSame(c,h,a.FieldTypes.email)};
b.isDomainSpecific=!0;b.fillFormTypes=[a.FormTypes.loginForm];b.isComposedOf=function(e,g){var c=0<=e.indexOf(a.FieldTypes.password),h=0<=e.indexOf(a.FieldTypes.username),b=0<=e.indexOf(a.FieldTypes.email);return g?h||b||c:c&&(h||b)};var v=[b,l,q,m,r,k,p,n,t,u,w,f,d];return{createRealType:function(a){return v.filter(function(g){return a===g.subType})[0]},getAllRealTypes:function(){return v}}}(TypeDefinitions);"undefined"!==typeof module&&(module.exports=RealTypeFactory);
"undefined"!==typeof require&&(RealTypeFactory=require("./real-type-factory"));
var Utils=function(a){function b(b,f){var l=[],q=[];b.forEach(function(b){var d=f.filter(function(d){var f=JSON.stringify(d.data),n=JSON.stringify(b.data);return b.realType===d.realType&&a.createRealType(b.realType).compare(n,f)})[0];void 0===d?l.push(b):q.push({id:d.id,data:b.data})});return{newItems:l,existingItems:f}}return{normalizeSubmitData:function(a){if("string"===typeof a){var b={};a.split("&").forEach(function(a){a=a.split("=");void 0===b[a[0]]&&(b[a[0]]=[]);b[decodeURIComponent(a[0])].push(decodeURIComponent(a[1]))});
return b}return a},getCreditCardType:function(a){var b="Other";/^5[1-5]/.test(a)?b="MasterCard":/^4/.test(a)?b="Visa":/^3[47]/.test(a)&&(b="American Express");return b},deriveDate:function(a){return{day:a.getUTCDate(),month:a.getUTCMonth()+1,year:a.getUTCFullYear()}},composeDate:function(a,b,l){return a?(new Date(Date.UTC(l,b-1,a,23,59,59,999))).toISOString():(new Date(Date.UTC(l,b,1)-1)).toISOString()},isEmailValid:function(a){return/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(a)},
bulkCompareSecureItems:function(a,f){return JSON.stringify(b(JSON.parse(a),JSON.parse(f)))}}}(RealTypeFactory);"undefined"!==typeof module&&(module.exports=Utils);"undefined"!==typeof require&&(TypeDefinitions=require("./type-definitions"));
var FormTypeDetector=function(a){function b(b){return b.buttonRecords.some(function(b){return b.buttonType===a.ButtonTypes.signupButton})}function d(b){return b.buttonRecords.some(function(b){return b.buttonType===a.ButtonTypes.loginButton})}function f(b,d){function f(){var d=b.inputRecords.some(function(e){return e.fieldType===a.FieldTypes.password}),p=b.inputRecords.some(function(e){return e.fieldType===a.FieldTypes.email}),n=b.inputRecords.some(function(e){return e.fieldType===a.FieldTypes.username});
return d&&p!==n}function t(){var d=[a.FieldTypes.username,a.FieldTypes.email,a.FieldTypes.password];return b.inputRecords.some(function(a){return-1!==d.indexOf(a.fieldType)})}return function(b){var d=[a.FieldTypes.firstName,a.FieldTypes.lastName,a.FieldTypes.reEnterPassword,a.FieldTypes.fullName];return b.inputRecords.every(function(a){return-1===d.indexOf(a.fieldType)})}(b)&&(f()||d&&t()||l(b))}function l(b){var d=b.inputRecords.filter(function(b){return b.fieldType!==a.FieldTypes.unknown}).map(function(a){return a.fieldType});
if(0===d.length)return!1;b=d.every(function(b){return b===a.FieldTypes.username});d=d.every(function(b){return b===a.FieldTypes.password});return b||d}function q(k,p){return b(k)&&!d(k)?a.FormTypes.signupForm:f(k,p)?a.FormTypes.loginForm:a.FormTypes.unknownForm}function m(b,d){return b.formRecords.filter(function(b){return FormTypeDetector.detectFormType(b,d)===a.FormTypes.loginForm})[0]||null}function r(a,b){return a.formRecords.filter(function(a){return a.inputRecords.some(function(a){return a.path===
b})})[0]}return{detectFormType:q,detectFormTypeJson:function(a,b){return q(JSON.parse(a),b)},findFormRecordFromSubmitData:function(a,b){var d=a.formRecords.map(function(a){return{formRecord:a,rank:a.inputRecords.filter(function(a){return void 0!==b[a.name]}).length}}).sort(function(a,b){return b.rank-a.rank});return 0<d.length?d[0].formRecord:void 0},findLoginFormRecord:function(a,b){return JSON.stringify(m(JSON.parse(a),b))},isProbablyMultiStep:function(a){return l(JSON.parse(a))},detectFormTypeForInputPath:function(a,
b,d){a=r(JSON.parse(a),d);return q(a,b)}}}(TypeDefinitions);"undefined"!==typeof module&&(module.exports=FormTypeDetector);"undefined"!==typeof require&&(TypeDefinitions=require("./type-definitions"));function Node(a,b){this.path=a;this.inputRecords=b.filter(function(a){return 0===a.path.indexOf(this.path)},this);this.allInputRecords=b}Node.prototype.parent=function(){return""===this.path?null:new Node(this.path.split(">").slice(0,-1).join(">"),this.allInputRecords)};
Node.prototype.findConflicts=function(a){var b={},d=[];this.inputRecords.forEach(function(f){0<=a.indexOf(f.fieldType)&&Object.prototype.hasOwnProperty.call(b,f.fieldType)&&d.push(f);f.fieldType!==TypeDefinitions.FieldTypes.unknown&&(b[f.fieldType]=!0)});return d};Node.prototype.hasConflicts=function(a){return 0<this.findConflicts(a).length};"undefined"!==typeof module&&(module.exports=Node);
"undefined"!==typeof require&&(Utils=require("./utils"),TypeDefinitions=require("./type-definitions"),RealTypeFactory=require("./real-type-factory"),FormTypeDetector=require("./form-type-detector"),Node=require("./node"));
var RealTypeDetector=function(a,b,d,f,l){function q(e,g,c,h,d){var f=e.filter(function(a){return a.fieldType!==b.FieldTypes.unknown}).map(function(a){return a.fieldType});if(0===f.length)return[];var l=f.some(function(a){return a===b.FieldTypes.username}),k=f.every(function(a){return a===b.FieldTypes.username}),q=f.every(function(a){return a===b.FieldTypes.password}),p=k||q;return a.filter(function(a){return c!==b.RealTypeUsage.fill||0<=a.fillFormTypes.indexOf(h)}).filter(function(a){return c!==b.RealTypeUsage.capture||
0<=a.captureFormTypes.indexOf(h)}).filter(function(a){return a.isComposedOf(f,c!==b.RealTypeUsage.capture&&(d||p))}).map(function(a){return{name:a.subType,isDomainSpecific:!!a.isDomainSpecific,inputRecords:e.filter(function(e){return a.fieldTypes.some(function(g){return"PV"===a.type&&g===b.FieldTypes.email&&l?!1:"object"===typeof g?0<=g.indexOf(e.fieldType):g===e.fieldType})}).map(function(e){e=JSON.parse(JSON.stringify(e));"PV"===a.type&&e.fieldType===b.FieldTypes.email&&(e.fieldType=b.FieldTypes.username);
return e}),path:g}})}function m(e,g,c){for(var h=[],f,k,p,m=e.inputRecords,n=(new l(e.path,m)).findConflicts(Object.keys(b.FieldTypes)),r=d.detectFormType(e,c);0<n.length;){for(f=new l(n[0].path,m);null!==f.parent()&&!1===f.parent().hasConflicts([n[0].fieldType]);)f=f.parent();p=a.filter(function(a){return 0<=a.discriminatorFieldTypes.indexOf(n[0].fieldType)});0===p.length?(m=m.filter(function(a){return n[0]!==a}),n.splice(0,1)):(k=f.inputRecords.filter(function(a){return p.some(function(e){return 0<=
e.fieldTypes.indexOf(a.fieldType)})}),q(k,f.path,g,r,c).forEach(function(a){h.push(a)}),n=n.filter(function(a){return 0>k.indexOf(a)}),m=m.filter(function(a){return 0>k.indexOf(a)}))}q(m,e.path,g,r,c).forEach(function(a){h.push(a)});return h}function r(a,g){var c=[];a.inputRecords=a.inputRecords.filter(function(a){return 0<a.value.trim().length});m(a,b.RealTypeUsage.capture,g).forEach(function(a){var e={};a.inputRecords.forEach(function(a){e[a.fieldType]=a.value});"CreditCard"===a.name&&(e[b.FieldTypes.cardType]=
f.getCreditCardType(e[b.FieldTypes.cardNumber]));if("Email"!==a.name||f.isEmailValid(e[b.FieldTypes.email]))n(e),p("expires",e),p("dateOfBirth",e),p("issueDate",e),c.push({realType:a.name,data:e})});return c}function k(a,b){if(b[a]){var c=f.deriveDate(new Date(b[a]));b[a+"Day"]=c.day;b[a+"Month"]=c.month;b[a+"Year"]=c.year;delete b[a]}}function p(a,b){var c=b[a+"Year"],h=b[a+"Month"],d=b[a+"Day"];h&&c&&(b[a]=f.composeDate(d?d:void 0,h,c))}function n(a){var g=a[b.FieldTypes.fullName];g&&(g=g.split(" "),
a[b.FieldTypes.firstName]=g[0],a[b.FieldTypes.lastName]=g[1],delete a[b.FieldTypes.fullName])}function t(a,b,c,h){return m(a,b,c).filter(function(a){return a.inputRecords.some(function(a){return a.path===h})})}function u(a,g,c,h,d){a=m(a,b.RealTypeUsage.fill,g);var f=[];c[b.FieldTypes.fullName]=c.firstName+" "+c.lastName;k("expires",c);k("dateOfBirth",c);k("issueDate",c);a.filter(function(a){return a.name===h}).forEach(function(a){a.inputRecords.forEach(function(b){f.push({fieldPath:b.path,fieldValue:c[b.fieldType]?
c[b.fieldType]:"",alternativeValues:[],overwriteExistingValue:"*"===d||0===d.indexOf(a.path)})})});return f}function w(a,g){var c=[];a.inputRecords.filter(function(a){return a.fieldType===b.FieldTypes.password||a.fieldType===b.FieldTypes.reEnterPassword}).forEach(function(a){c.push({fieldPath:a.path,fieldValue:g,alternativeValues:[],overwriteExistingValue:!0})});return c}function v(a,b){return a.formRecords.filter(function(a){return a.inputRecords.some(function(a){return a.path===b})})[0]}return{extractFromPageRecord:function(a,
g,c){a=v(JSON.parse(a),c);a=m(a,"fill",g);a=a.filter(function(a){var e=a.inputRecords.some(function(a){return a.fieldType===b.FieldTypes.username||a.fieldType===b.FieldTypes.email});return!g||"PV"!==a.name||e});a=a.map(function(a){a.selected=a.inputRecords.some(function(a){return a.path===c});return a});return JSON.stringify(a)},getRealTypeDataForSubmit:function(a,b){var c=JSON.parse(a);return JSON.stringify(r(c,b))},generateFillDataMessage:function(a,b,c,d,f){return JSON.stringify(u(JSON.parse(a),
b,JSON.parse(c),d,f))},generateFillDataMessageForPageRecord:function(a,b,c,d,f,k,l,m){a=v(JSON.parse(a),f);return JSON.stringify({formPath:a.path,data:u(a,b,JSON.parse(c),d,f),executeLogin:"true"===k,message:"fillDataBegin",contentId:l,tabId:m})},generateFillDataMessageForOneClickLogin:function(a,b,c,f,k){a=JSON.parse(d.findLoginFormRecord(a,b));return JSON.stringify({formPath:a.path,data:u(a,b,JSON.parse(c),"PV","*"),executeLogin:!0,message:"fillDataBegin",contentId:f,tabId:k})},getFormRecordForInputPath:function(a,
b){return JSON.stringify(v(JSON.parse(a),b))},getRealTypeForInputPath:function(a,b,c){a=v(JSON.parse(a),b);return JSON.stringify(t(a,"fill",c,b))},generatePasswordGeneratorMessage:function(a,b,c,d,f){a=v(JSON.parse(a),c);return JSON.stringify({formPath:a.path,data:w(a,b),executeLogin:!1,message:"fillDataBegin",contentId:d,tabId:f})}}}(RealTypeFactory.getAllRealTypes(),TypeDefinitions,FormTypeDetector,Utils,Node);"undefined"!==typeof module&&(module.exports=RealTypeDetector);
